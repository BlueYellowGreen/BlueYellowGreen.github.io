<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Smart Contract &amp; Solidity | LDH Note</title>
    <meta name="generator" content="VuePress 1.8.3">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16.png">
    <link rel="shortcut icon" href="/assets/favicons/favicon.ico">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-23KGQVB87M"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-23KGQVB87M');</script>
    <meta name="description" content="BApp (Klaytn) 개발하기">
    <meta property="og:title" content="Smart Contract &amp; Solidity">
    <meta property="og:description" content="BApp (Klaytn) 개발하기">
    <meta property="og:image" content="">
    <meta property="og:url" content="https://leedooho.com/Blockchain/BApp/Smart-Contract-and-Solidity.html">
    <meta name="charset" content="utf-8">
    
    <link rel="preload" href="/assets/css/0.styles.10edf211.css" as="style"><link rel="preload" href="/assets/js/app.0ef05f26.js" as="script"><link rel="preload" href="/assets/js/2.7be8156e.js" as="script"><link rel="preload" href="/assets/js/42.b90bda13.js" as="script"><link rel="preload" href="/assets/js/37.c7880ac5.js" as="script"><link rel="prefetch" href="/assets/js/10.52419b77.js"><link rel="prefetch" href="/assets/js/11.662ba05b.js"><link rel="prefetch" href="/assets/js/12.189d6f01.js"><link rel="prefetch" href="/assets/js/13.81ecece4.js"><link rel="prefetch" href="/assets/js/14.a674bf1c.js"><link rel="prefetch" href="/assets/js/15.3da3c840.js"><link rel="prefetch" href="/assets/js/16.e18de7c7.js"><link rel="prefetch" href="/assets/js/17.5d3e9bea.js"><link rel="prefetch" href="/assets/js/18.ad7065eb.js"><link rel="prefetch" href="/assets/js/19.c89a62e1.js"><link rel="prefetch" href="/assets/js/20.733b42dd.js"><link rel="prefetch" href="/assets/js/21.d6485c5d.js"><link rel="prefetch" href="/assets/js/22.5294f975.js"><link rel="prefetch" href="/assets/js/23.4184da9c.js"><link rel="prefetch" href="/assets/js/24.e5607ab0.js"><link rel="prefetch" href="/assets/js/25.b62df304.js"><link rel="prefetch" href="/assets/js/26.295961da.js"><link rel="prefetch" href="/assets/js/27.a79d73e1.js"><link rel="prefetch" href="/assets/js/28.bf78ea18.js"><link rel="prefetch" href="/assets/js/29.b8b165d9.js"><link rel="prefetch" href="/assets/js/3.76558b67.js"><link rel="prefetch" href="/assets/js/30.9c2ce01a.js"><link rel="prefetch" href="/assets/js/31.1b46576c.js"><link rel="prefetch" href="/assets/js/32.1821c629.js"><link rel="prefetch" href="/assets/js/33.bf1751a1.js"><link rel="prefetch" href="/assets/js/34.45b4dd8e.js"><link rel="prefetch" href="/assets/js/35.62876489.js"><link rel="prefetch" href="/assets/js/36.b909f7e6.js"><link rel="prefetch" href="/assets/js/38.a6bd5a4b.js"><link rel="prefetch" href="/assets/js/39.01c90e8d.js"><link rel="prefetch" href="/assets/js/4.a9922f00.js"><link rel="prefetch" href="/assets/js/40.47859ce2.js"><link rel="prefetch" href="/assets/js/41.4c34e371.js"><link rel="prefetch" href="/assets/js/43.5cfe77a6.js"><link rel="prefetch" href="/assets/js/44.6bb4f33a.js"><link rel="prefetch" href="/assets/js/45.4ba03437.js"><link rel="prefetch" href="/assets/js/46.8f541616.js"><link rel="prefetch" href="/assets/js/47.61536cd3.js"><link rel="prefetch" href="/assets/js/48.478f71a0.js"><link rel="prefetch" href="/assets/js/49.f14d3fc6.js"><link rel="prefetch" href="/assets/js/5.0ba7bf9c.js"><link rel="prefetch" href="/assets/js/50.2c4375ea.js"><link rel="prefetch" href="/assets/js/51.99b9a6de.js"><link rel="prefetch" href="/assets/js/52.66d7a047.js"><link rel="prefetch" href="/assets/js/53.a3d76e1b.js"><link rel="prefetch" href="/assets/js/54.4912bc89.js"><link rel="prefetch" href="/assets/js/6.3be4ccd1.js"><link rel="prefetch" href="/assets/js/7.44679647.js"><link rel="prefetch" href="/assets/js/8.d8edd2eb.js"><link rel="prefetch" href="/assets/js/9.631d5f0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.10edf211.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo-50.png" alt="LDH Note" class="logo"> <span class="site-name can-hide">LDH Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Portfolio/" class="nav-link">
  Portfolio
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Portfolio/" class="nav-link">
  Portfolio
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Blockchain</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Blockchain/BApp/" class="sidebar-heading clickable router-link-active open"><span>BApp</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blockchain/BApp/Smart-Contract-and-Solidity/" aria-current="page" class="active sidebar-link">Smart Contract &amp; Solidity</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Blockchain/Web/" class="sidebar-heading clickable"><span>Web 3.0 (PFP)</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="smart-contract-solidity"><a href="#smart-contract-solidity" class="header-anchor">#</a> Smart Contract &amp; Solidity</h1> <details class="custom-block details"><summary>진행 과정</summary> <ol><li><strong>Smart Contract 개발</strong> <ul><li>Smart Contract 개념</li> <li>Solidity 기초 학습</li> <li>Smart Contract 배포 (실제 네트워크에)</li> <li>NFT에 대하여</li> <li>NFT 토큰 발행</li></ul></li> <li><strong>Klaytn API 연동</strong> <ul><li>실제 배포한 Smart Contract를 웹/앱 연동</li></ul></li> <li><strong>Market BApp 개발</strong> <ul><li>배운 지식을 토대로 Market BApp 개발
<ul><li>배포한 Smart Contract 연결</li></ul></li></ul></li></ol></details> <p>위의 과정을 통해 블록체인 기반 서비스를 <strong>설계</strong>하는 기본 과정부터 개발해서 <strong>배포</strong>하는 전체 프로세스를 경험해서, BApp 개발이 어떤 것인지에 대한 큰 그림을 그리는 것을 목표로 한다.</p> <br> <h3 id="bapp-개발-과정"><a href="#bapp-개발-과정" class="header-anchor">#</a> BApp 개발 과정</h3> <p>블록체인 <strong>BApp</strong>을 만들기 위해서는 <u><strong>Smart Contract를 만들고 배포</strong></u>하는 일이 필요하다.</p> <p>Smart Contract는 <strong>Solidity</strong>(이더리움에서 제공하는 언어)로 만들게 되는데, <br>
이 Solidity를 가지고 어떤식으로 NFT Smart Contract를 만드는지, Market Smart Contract도 만들어서 어떤식으로 Blockchain Market App을 만들어서 사용할 지 전체적으로 살펴본다.</p> <p>그리고 Smart Contract는 2가지 종류를 만들어 연동하는 방법을 알아 볼 것이고,<br>
이를 직접 <strong>테스트넷에 배포</strong>해서 사용할 것이다.</p> <p>그 후 직접 만든 Smart Contract를 <strong>웹/앱</strong>에서 사용할 것이다. <br>
하지만 Blockchain Smart Contract는 배포한다고 유저들이 사용하기에는 쉽지 않다. <br>
그래서 BApp 서비스를 만든다고 했을 때 Smart Contract만 반응하는 것 뿐만이 아니라,<br>
어떻게 일반 유저분들이 웹/앱에서 어떻게 사용하게 할 수 있을지 <strong>UI/UX까지 고려</strong>해야 한다.</p> <p>&amp;이러한 점을 고려하여 BApp을 설계 및 개발 후 배포하여 일반 유저분들이 사용할 수 있도록하고,<br>
살펴본 내용을 바탕으로 Market Smart Contract, NFT Smart Contract를 연동한다.</p> <p>그리고 Klip Wallet을 연동해서 Market BApp을 사용하게 한다. <br>
마지막으로는 Klaytn MainNet에 배포하는 것을 목표로 한다.</p> <br> <hr> <h3 id="klaytn"><a href="#klaytn" class="header-anchor">#</a> Klaytn</h3> <p>개발에 앞서서 개발자용 지갑을 만들어야 한다.<br>
지갑을 만드는 과정은 다소 복잡할 수 있는데, Klaytn Wallet은 쉽게 만들 수 있다.</p> <p><a href="https://wallet.klaytn.com/" target="_blank" rel="noopener noreferrer"><strong>Klaytn Wallet</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 개인정보 이용 동의 후,
Main Network ➜ <strong>Baobab Network</strong>로 변경한다.<br>
그런 다음 왼쪽 상단의 '<strong>Create Account</strong>'를 클릭하고, 암호화에 적용시킬 비밀번호를 입력한다.<br>
(입력하지 않아도 되지만, 조금 더 안전하게 설정하기 위해서는 입력하는 것이 좋다.)</p> <p>생성 후 '<strong>Download &amp; Next Step</strong>' 버튼을 누르면 입력했던 비밀번호를 바탕으로 암호화된 개인키를 <strong>json</strong> 형태로 다운받을 수 있다. 그리고 Private Key와 Klaytn Wallet Key 도 다른 안전한 곳에 입력해서 보관해둔다.
(<strong>Private Key는 절대로 공개되어서는 안된다!</strong>)</p> <p>그 후 '<strong>View Account Info</strong>' 버튼을 클릭한 뒤, 개인 Private Key를 입력하면 현재 자신의 지갑 정보(Account, Address 등)를 확인할 수 있다.</p> <br> <p>다음으로, Test 용으로 사용할 Klaytn을 얻기위해 Klaytn Wallet 홈페이지 왼쪽의 '<strong>KLAY Faucet</strong>'에서 '<strong>Run Faucet</strong>'을 클릭한다. 그러면 <strong>5 Klay</strong>를 받을 수 있다. <u><strong>재 신청은 24시간 뒤에 가능</strong></u>하다.</p> <p>지급받은 Klay를 확인하고 싶다면 <a href="https://baobab.scope.klaytn.com/" target="_blank" rel="noopener noreferrer"><strong>Baobab Klaytn Scope</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 Address를 입력해 확인할 수 있다. (Baobab 개발 주소를 입력해야 한다.)</p> <br> <p><strong>이제, Smart Contract를 만들어서 배포해보자!</strong></p> <br> <p>코딩 작업은 <a href="https://ide.klaytn.com/" target="_blank" rel="noopener noreferrer"><strong>Klaytn IDE</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 웹 상에서 쉽게 개발할 수 있다.<br></p> <p>이제 기초적인 Smart Contract를 만들어보자.<br>
IDE에 접속하면, 새로운 Workspace를 생성하고, <strong>contracts/</strong> 폴더에 <strong>count.sol</strong>을 생성하여 아래의 코드를 입력한다. (접근이 편리한 경로에 생성)</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// Klaytn IDE uses solidity 0.4.24, 0.5.6 versions.</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Count</span> <span class="token punctuation">{</span>
    <span class="token comment">// Storage variable 'count' (type: uint256)</span>
    <span class="token builtin">uint256</span> <span class="token keyword">public</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Get current node a block number.</span>
    <span class="token keyword">function</span> <span class="token function">getBlockNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> block<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Set value of storage variable 'count'.</span>
    <span class="token keyword">function</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _count<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        count <span class="token operator">=</span> _count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>그리고 해당 파일을 우클릭하여 <strong>complie</strong>을 클릭한다.</p> <p><strong>COMPILER</strong>는 <strong>0.5.6</strong> 버전으로(0.4.24 or 0.5.6 을 사용하면 됨) 선택하고, <strong>LANGUAGE</strong>는 <strong>Solidity</strong>로, 그리고 <strong>EVM VERSION</strong>은 <strong>constantinople</strong> (<strong>Cypress</strong>)로 선택한 뒤 '<strong>Compile count.sol</strong>'을 클릭한다.</p> <p>그러면 count.sol이 있는 경로에 <strong>artifacts/</strong> 폴더가 생성되며 내부에는 <strong>Count_metadata.json</strong>과 <strong>Count.json</strong>이 있는 것을 확인할 수 있다.</p> <br> <p>다음으로 이 기본적인 Smart Contract를 배포할 차례이다.<br>
'<strong>Deploy &amp; run transactions</strong>' 탭에서 <strong>ENVIRONMENT</strong>를 <strong>Baobab</strong>으로 선택하고, <strong>ACCOUNT</strong>의 '<strong>+</strong>'를 클릭하여 개인 <strong>Private Key</strong>를 입력한다.
올바른 Private Key라면, 개인 Address 옆에 5 Klay (잔액)이 표시된다.<br>
그리고 <strong>CONTRACT</strong> 부분에 <strong>Count</strong>가 표시되면 정상적으로 진행되고 있는 것이다.</p> <p><strong>Deploy</strong>를 클릭한다.</p> <p>그러면 아래의 콘솔창에,</p> <div class="language- extra-class"><pre class="language-text"><code>[block:80396659 txIndex:0] from: 0x... to: Count.(constructor) value: 0 peb data: 0x... logs: 0 hash 0x...
</code></pre></div><p>이 출력된다. block 옆에 적히는 숫자는 다를 것이다.</p> <p>이제 '<strong>Deployed Contracts</strong>'를 보면 'setCount', 'count', 'getBlockNumber' 항목이 있다. count는 <code>uint256 public count = 0;</code>에 의해 나온 것이고, setCount와 getBlockNumber는 각각 작성한 함수이다.<br> <strong>getBlockNumber</strong>를 누르면 현재 Blockchain에서의 Block Number를 가져오는데, 계속해서 바뀌는 것을 확인할 수 있다. (콘솔에는 <code>[call]</code> 형태로 출력된다.)</p> <p>이번에는 setCount의 숫자를 10으로 바꾸고 setCount 버튼을 클릭한다.<br>
그러면 콘솔에는 <code>[call]</code> 형태가 아니라 처음에 보았던 형태에서 숫자만 다른, <code>[block:80401126]</code>을 볼 수 있다. 거래 수수료로 인해 개인 Klay도 줄은 것을 확인할 수 있고, count 버튼을 클릭하면 0 ➜ 10 으로 바뀐 것도 확인할 수 있다.</p> <p>지금 Baobab Network에 배포하고, Smart Contract까지 실행하여 값을 바꾼 것이다!</p> <br> <hr> <h3 id="smart-contract"><a href="#smart-contract" class="header-anchor">#</a> Smart Contract</h3> <p>일단 무언가를 작성해서 컴파일하고 배포한 뒤 실행을 했는데, 의미를 모르고 진행했다.<br>
그래서 간략하게 해당 과정이 어떠한 의미를 가지고 있는지 알아보고자 한다.</p> <p>우선 일반적으로 웹을 개발할 때, localhost로 배포(?)를 하면 당연하게도 다른 유저가 접근할 수 없다.<br>
하지만 Blockchain의 경우 <strong>해당 네트워크로만 배포</strong>하게 되어 있어서, 다른 유저가 접근할 수 있게 코드를 작성했다면 <strong>contract address</strong>를 통해 다른 유저도 사용할 수 있다.<br>
(IDE에서는 Deployed Contracts에서 확인할 수 있다.)</p> <p>그리고 추가적으로, Baobab Klaytn Scope에서 해당 <strong>transaction hash</strong>를 검색했을 때 나오는 Input Data에 적힌 부분이, 우리가 작성했던 count.sol <strong>코드 및 입력 데이터 내용</strong>이다.</p> <h4 id="account"><a href="#account" class="header-anchor">#</a> Account</h4> <p>Blockchain에서 Account는 2가지 종류가 있다.</p> <ul><li><strong>Smart Contract Account</strong></li> <li><strong>Private Key Account</strong></li></ul> <p>Private Key Account는 우리가 Klaytn Wallet에서 만든 방식이고, 아무나 제한없이 만들 수 있다.<br>
Private Key를 바탕으로 Address가 나오고, 이 Address는 일종의 계좌번호인 셈이다.</p> <p>Smart Contract도 네트워크상에 배포가 되면 일종의 계좌번호가 생기게된다.<br>
위에서 언급한 <strong>contract address</strong>가 이에 해당한다. 다만 Private Key Account와의 차이는 <u><strong>Code도 보관</strong></u>한다는 점이다.</p> <h4 id="transaction"><a href="#transaction" class="header-anchor">#</a> Transaction</h4> <p>Blockchain에서의 모든 활동을 의미한다.<br>
해당 활동들은 <strong>transaction hash</strong>라는 일종의 일련번호가 붙게 된다.<br>
그리고, 배포된 Code를 기반으로 돈(KLAY)을 보내거나 받을 수 있는데, 해당 코드를 실행시키는데 돈(KLAY)가 든다.</p> <h4 id="수수료"><a href="#수수료" class="header-anchor">#</a> 수수료</h4> <p><code>수수료 = GAS * GAS_PRICE</code></p> <p>Klaytn에서 GAS_PRICE는 정해져있다. (0.000000025 KLAY)<br>
그리고 GAS는 실행시키는 코드에 따라 달라진다.</p> <br> <hr> <h3 id="solidity"><a href="#solidity" class="header-anchor">#</a> Solidity</h3> <p>Smart Contract 코드 구조는 <code>contract</code>로 시작하게 된다.<br>
배포하면 contract 옆에 적힌 이름을 가진 contract가 생성된다.</p> <p>연습용 Smart Contract를 생성해보자.</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>위의 코드를 작성한 후, <strong>0.5.6 version</strong>의 COMPILER로 <strong>constantinople</strong> <strong>(Cypress)</strong> EVM VERSION 으로 compile 후 deploy하면 contract address를 얻을 수 있다. 하지만 아무런 내용이 없는 상황이다.</p> <p>숫자 및 문자를 넣어보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">public</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>public</code>을 통해 Smart Contract 에서 바로 볼 수 있게 한다.<br>
반대로 <code>private</code>은 바로 볼 수 없게 한다.</p> <p>그렇지만 함수를 이용하여 private를 볼 수 있다.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">private</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">getTotalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>public</strong>으로 getTotleSupply 함수를 공개하고, 보여주기 전용 함수로 만들기 위해 <strong>view</strong>, 그리고 양수를 보여주니 <strong>returns</strong>는 <strong>uint256</strong>으로 한다.</p> <p>Deploy 후 Deployed Contracts에서 '<strong>getTotalSupply</strong>'를 누르면 private인 totalSupply를 받아와 확인할 수 있다.</p> <p>추가로 totalSupply를 변경하는 함수를 만들어보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">private</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">getTotalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTotalSupply</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> newSupply<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        totalSupply <span class="token operator">=</span> newSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>변경하려는 수량을 입력해야 하니, 양수 형태인 <strong>uint256</strong>으로 newSupply란 이름으로 받고, <strong>public</strong>으로 공개시키며, 조작하는 로직이 있으니 <strong>view는 적지 않는다</strong>. 그리고 returns 도 딱히 적지 않아도 된다.</p> <p>Deploy 후 마찬가지로 Deployed Contracts를 살펴보자.<br>
이전에 간략히 살펴봤던 수수료 부분을 떠올려보면, getTotalSupply 함수와 name 을 클릭해 확인해보는 과정은 <strong>추가 및 수정이 없기 때문에 수수료가 들지 않는다.</strong><br>
(콘솔 창에서도 <code>[call]</code> 형태로 나타남)</p> <p>하지만 setTotalSupply 처럼 수정 로직을 실행시키는 transaction은 수수료가 든다.<br>
실행시켜본 결과 약 0.0007 KLAY가 소모되었다.<br>
(콘솔 창에서 <code>[block]</code> 형태로 나타남)</p> <br> <p>그리고 위에서 언급했듯이, Smart Contract에도 address가 있다.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">private</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span> <span class="token comment">// constract deployer</span>

    <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getTotalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTotalSupply</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> newSupply<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        totalSupply <span class="token operator">=</span> newSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>address를 알아보기 위해 <strong>address</strong> 타입의 owner를 public으로 선언하고, <strong>constructor</strong> 라는 생성자를 통해 owner에 address를 할당한다.<br> <code>owner = msg.sender</code> ➜ Smart Contract를 실행한 애를 owner에 할당하라!</p> <p>solidity에서도 생성자라고, 배포되자마자 실행하도록 하는 기능이 존재한다.</p> <p>그래서 Deploy 후 '<strong>owner</strong>'를 클릭해보면 Smart Contract의 address를 볼 수 있다.</p> <br> <p>이제 조금 더 나아가, Smart Contract를 배포한 사람만이 내용을 수정할 수 있게 하려면 <code>require()</code>를 사용하면 된다.<br>
require는 () 안의 조건을 만족하면 다음 코드를 실행시키고, contract를 fail 시킨다.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">private</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span> <span class="token comment">// constract deployer</span>

    <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getTotalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTotalSupply</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> newSupply<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>owner <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">'Not owner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalSupply <span class="token operator">=</span> newSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>require() 안의 내용은 배포한 사람이라면 다음 코드를 실행시키고, 아니면 'Not owner'를 출력시킨다는 의미이다.</p> <p>Fail을 확인해보기 위해 테스트용 다른 지갑으로 로그인한 뒤 '<strong>setTotalSupply</strong>'를 실행시켜보자.</p> <p>우선 Klaytn IDE 상에서는 버튼을 누르면 <strong>Gas estimation failed</strong>라는 경고창이 나타난다. 그럼에도 <strong>send transaction</strong>을 누르면, 아래 콘솔창에 해당 블럭의 status가 <code>false Transaction mined but execution failed</code>로 나타난다.</p> <br> <p>다음으로 <code>mapping</code>에 대해서 알아보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> <span class="token keyword">private</span> totalSupply <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token builtin">address</span> <span class="token keyword">public</span> owner<span class="token punctuation">;</span> <span class="token comment">// constract deployer</span>
    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokenURIs<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getTotalSupply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTotalSupply</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> newSupply<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>owner <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">'Not owner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalSupply <span class="token operator">=</span> newSupply<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTokenUri</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> id<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> uri<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        tokenURIs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> uri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>괄호 안의 의미는, 숫자 형태의 키를 입력해 문자열을 값을 얻는다는 뜻이다.</p> <p>그리고 mapping에 내용을 추가하기 위한 함수 '<strong>setTokenUri</strong>'가 있다. 여기서 <strong>memory</strong>는 조금 복잡한 문자열을 다룰 때 필요하다.</p> <p>배포 후 '<strong>setTokenUri</strong>'에 <code>5, &quot;Hello, Klaytn&quot;</code>같이 Key-Value 형태로 입력 후 클릭한 다음, '<strong>tokenURIs</strong>' 에 5를 입력하고 클릭하면 입력했던 값을 확인할 수 있다.</p> <br> <p>이제 <strong>NFT</strong>를 발행해보자!</p> <h4 id="nft-non-fungible-token"><a href="#nft-non-fungible-token" class="header-anchor">#</a> NFT (Non Fungible Token)</h4> <p>디지털 자산의 일종으로, 대체 불가능한 특정 암호 디지털 자산이다.<br>
Blockchain에 저장함으로써 영구 보존하고, 소유권의 위조 · 변조가 불가능하다.</p> <p>NFT를 만들기 위해서 최소한</p> <ul><li>발행(일련번호, 내용, 소유자)
<ul><li>mint(tokenId, uri, owner)</li></ul></li> <li>전송(누가, 누구에게, 무엇을)
<ul><li>transferFrom(from, to, tokenId)</li></ul></li></ul> <p>이러한 정보가 필요할 것이다.</p> <p>기존 코드에서 필요한 부분만 남기고 작성해보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token builtin">string</span> <span class="token keyword">public</span> symbol <span class="token operator">=</span> <span class="token string">&quot;MN&quot;</span><span class="token punctuation">;</span> <span class="token comment">// My NFT</span>

    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokenOwner<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokenURIs<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">mintWithTokenURI</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> tokenURI<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// to에게 tokenId를 발행</span>
        <span class="token comment">// 내용은 tokenURI</span>
        tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">;</span>
        tokenURIs<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> tokenURI<span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">safeTransferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">&quot;from != msg.sender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;you are not the owner of the token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTokenUri</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> id<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> uri<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        tokenURIs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> uri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>NFT 일련번호에 소유자 및 내용을 입력하기 위한 mapping을 선언한다.<br>
그리고 발행을 위한 함수를 만들어서 <strong>일련번호</strong>를 Key로, <strong>소유주</strong>와 <strong>내용</strong>을 Value로 추가한다.</p> <p>전송을 위한 함수에서는 아무나 접근할 수 없도록, <code>require</code>를 이용하여 소유주만이 접근할 수 있도록 한다. 이렇게 설정하면, 타인이 시도할 경우 transaciton이 fail 할 것이다.</p> <br> <p>지금까지 NFT의 아주 기초적인 부분만 만들어 보았는데, 소유한 NFT를 조회하는 기능을 넣어보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.24</span> <span class="token operator">&lt;=</span><span class="token version number">0.5.6</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Practice</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> <span class="token keyword">public</span> name <span class="token operator">=</span> <span class="token string">&quot;KlayPractice&quot;</span><span class="token punctuation">;</span>

    <span class="token builtin">string</span> <span class="token keyword">public</span> symbol <span class="token operator">=</span> <span class="token string">&quot;MN&quot;</span><span class="token punctuation">;</span> <span class="token comment">// My NFT</span>

    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokenOwner<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tokenURIs<span class="token punctuation">;</span>

    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">private</span> _ownedTokens<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">mintWithTokenURI</span><span class="token punctuation">(</span><span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> tokenURI<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// to에게 tokenId를 발행</span>
        <span class="token comment">// 내용은 tokenURI</span>
        tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">;</span>
        tokenURIs<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> tokenURI<span class="token punctuation">;</span>

        _ownedTokens<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">safeTransferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">&quot;from != msg.sender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;you are not the owner of the token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_removeTokenFromList</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _ownedTokens<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">_removeTokenFromList</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint256</span> lastTokenIndex <span class="token operator">=</span> _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>_ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tokenId <span class="token operator">==</span> _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">[</span>lastTokenIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">[</span>lastTokenIndex<span class="token punctuation">]</span> <span class="token operator">=</span> tokenId<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        _ownedTokens<span class="token punctuation">[</span><span class="token keyword">from</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">ownedTokens</span><span class="token punctuation">(</span><span class="token builtin">address</span> owner<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _ownedTokens<span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setTokenUri</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> id<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> uri<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        tokenURIs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> uri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>먼저 address 별 NFT 일련번호를 담기 위한 mapping을 하나 선언한다.<br>
그래서 NFT를 발행하면 해당 address에 NFT 일련번호를 추가해줘야 해서, 해당 부분을 '<strong>mintWithTokenURI</strong>'에 추가로 구현한다.</p> <p>전송시, 양도해주는 사람의 mapping에 추가하는 부분은 간단하지만, <strong>본인의 mapping에서 해당 NFT 일련번호를 제거하는 부분은 추가로 구현</strong>해야 한다.</p> <p>제거하는 로직은 단순히 제거하고자 하는 NFT 일련번호를 찾은 뒤 마지막 원소와 <strong>swap</strong> 하고 <strong>배열의 길이를 하나 줄이는 방식</strong>으로 접근한다. 그리고 해당 로직이 구현된 함수를 '<strong>saftTransferFrom</strong>'에서 사용한다.</p> <p>마지막으로 address 별 NFT 목록을 확인하기 위한 함수를 public으로 구현하면 끝이다.</p> <p>이렇게 아주 기초적인 NFT 발행 · 전송하는 부분을 구현해냈다!</p> <br> <hr> <h3 id="contract-연동"><a href="#contract-연동" class="header-anchor">#</a> Contract 연동</h3> <p>이제는 다수의 Smart Contract를 연동하는 방법에 대해서 알아보자.<br>
배포된 Smart Contract 끼리는 연동이 가능하다. 다만 연동하려는 Smrat Contract에 대해서 최소한으로, 어떠한 기능이 있는지, 그리고 어떤 address를 가지고 있는지 알아야 한다.</p> <p>이제 코드를 작성해보자.<br>
(작성했던 <code>.sol</code> 파일에 이어서 작성해도 된다.)</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">NFTMarket</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">buyNFT</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">address</span> NFTAddress<span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">NFTSimple</span><span class="token punctuation">(</span>NFTAddress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>위 코드의 의미는 다음과 같다.<br> <code>NFTAddress</code> 주소에 있는 <strong>NFTSimple</strong>이라는 <strong>contract</strong>에서<code>safeTransferFrom</code>이라는 함수를 사용하겠다!<br>
(기존 작성했던 Practice ➜ NFTSimple 로 이름을 변경했다.)</p> <p>Deploy 후 기존 방식대로 NFT를 발행해서 NFTMarket 이라는 contract의 address로 NFT를 보내보자!</p> <p>조금 특이하지만 당연하게도, <u><strong>Smart Contract도 NFT를 소유할 수 있다.</strong></u><br>
NFTSimple(기존 Practice)에서 NFT를 발행한 뒤, NFTMarket으로 NFT를 전송할 수 있다.<br>
다만, NFTMarket에는 NFT를 조회하는 기능을 아직 만들지 않았기 때문에, <strong>NFTSimple</strong>에서 <strong>NFTMarket의 address</strong>를 이용하여 조회할 수 있다.</p> <p>이렇게 받은 NFT는 NFTSimple을 연동하여 safeTransferFrom 기능을 사용하는 <strong>buyNFT</strong> 함수를 통해 NFT를 다시 보낼 수 있다. (require() 조건이 맞는 경우에만)</p> <br> <hr> <h3 id="bapp-nft-market"><a href="#bapp-nft-market" class="header-anchor">#</a> BApp NFT Market</h3> <h4 id="kip-17-nft"><a href="#kip-17-nft" class="header-anchor">#</a> KIP-17 (NFT)</h4> <p><strong>KIP</strong>는 Klaytn Improvement Proposals의 약자로서, 누구든지 Klaytn Blockchain 오픈소스에 기여할 수 있다는 의미이다. <a href="https://kips.klaytn.com/" target="_blank" rel="noopener noreferrer"><strong>KIP Klaytn</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 자세한 내용을 살펴볼 수 있다. 오픈소스 활동을 통해 나타난 것들이 있는데, 대표적으로</p> <ul><li>KIP-7</li> <li>KIP-17</li></ul> <p>이 있다.<br>
KIP-7 은 <strong>FT</strong>에 관한 것으로 일반적인 토큰에 해당한다. 그리고 우리가 알아보려는 KIP-17이 <strong>NFT</strong>에 관한 것이다. KIP-17의 예제 코드는 <a href="https://github.com/klaytn/klaytn-contracts/tree/master/contracts/token/KIP17" target="_blank" rel="noopener noreferrer"><strong>이곳</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 확인할 수 있다.</p> <br> <p>이제 NFTMarket을 더 구현해보자.</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">NFTMarket</span> <span class="token punctuation">{</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> seller<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">buyNFT</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">address</span> NFTAddress<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">address</span> <span class="token keyword">payable</span> receiver <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>seller<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        receiver<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">**</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">NFTSimple</span><span class="token punctuation">(</span>NFTAddress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">safeTransferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> tokenId<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Market이 토큰을 받았을 때, 판매자가 누구인지 기록해야 함</span>
    <span class="token comment">// KIP-17 규격에 맞춰야 함 (공식문서 참고)</span>
    <span class="token keyword">function</span> <span class="token function">onKIP17Received</span><span class="token punctuation">(</span><span class="token builtin">address</span> operator<span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        seller<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">&quot;onKIP17Received(address,address,uint256,bytes)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>구매자를 기록하기 위해 mapping을 선언하고, <code>address to</code>부분 대신 <code>msg.sender</code>를 통해 <strong>구매자가 소유</strong>하도록 한다.</p> <p>그리고 seller에게 KLAY(예제에서는 0.1 KLAY로 고정)를 보내기 위해 <code>payable</code>를 이용한다. 즉, <code>receiver</code>는 seller가 KLAY를 받을 address이다.
그래서 0.01 KLAY를 보내기 위해서는 <code>receiver.transfer()</code>를 사용한다.</p> <p>한 가지 조심해야 하는 점은, 0.01 KLAY를 보내기 위해 괄호 안에 0.01을 적으면 안된다는 것이다. 괄호 안에는 <code>peb</code> 단위로서, <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="3.975ex" height="2.005ex" viewBox="0 -864 1757.1 886" style="vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1000, 393.1) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500, 0)"></path></g></g></g></g></g></svg></mjx-container> peb = 1 KLAY 이다. 그래서 <code>10 ** 16</code>으로 작성해야 원하는 양으로 보낼 수 있다.</p> <p>그리고 다음으로는 Market에서 NFT를 받았을 때, 판매한 사람의 정보를 기록해야 한다. KIP-17에 맞게 작성하자. (NFTSimple 에도 추가해야 함)</p> <div class="language-solidity extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">NFTSimple</span> <span class="token punctuation">{</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">private</span> _ownedTokens<span class="token punctuation">;</span>

    <span class="token builtin">bytes4</span> <span class="token keyword">private</span> <span class="token keyword">constant</span> _KIP17_RECEIVED <span class="token operator">=</span> <span class="token number">0x6745782b</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">function</span> <span class="token function">safeTransferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> _data<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token string">&quot;from != msg.sender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token keyword">from</span> <span class="token operator">==</span> tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;you are not the owner of the token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_removeTokenFromList</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _ownedToken<span class="token punctuation">[</span>to<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenOwner<span class="token punctuation">[</span>tokenId<span class="token punctuation">]</span> <span class="token operator">=</span> to<span class="token punctuation">;</span>

        <span class="token comment">// NFT 받는 쪽에서 실행할 코드가 있다면 실행하기</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>
            <span class="token function">_checkOnKIP17Received</span><span class="token punctuation">(</span><span class="token keyword">from</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> tokenId<span class="token punctuation">,</span> _data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;KIP17: transfer to non KIP17Receiver implementer&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">_checkOnKIP17Received</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> _data<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">bool</span> success<span class="token punctuation">;</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> returndata<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isContract</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">(</span>success<span class="token punctuation">,</span> returndata<span class="token punctuation">)</span> <span class="token operator">=</span> to<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
            _KIP17_RECEIVED<span class="token punctuation">,</span>
            msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token punctuation">,</span>
            tokenId<span class="token punctuation">,</span>
            _data
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/AI/Boostcamp-AI-Tech/" class="prev">
        Boostcamp AI Tech
      </a></span> <span class="next"><a href="/Blockchain/Web/Metamask-Login/">
        Metamask 로그인
      </a>
      →
    </span></p></div> </main></div> <div></div> <br> <br> <footer class="siteFooter"><p>© 2021 이두호. ALL RIGHTS RESERVED.</p> <p><span>dhdev5ba@gmail.com</span> <span> </span> <a target="_blank" href="https://github.com/BlueYellowGreen/">GITHUB</a> <span> </span> <a target="_blank" href="https://www.linkedin.com/in/dooho-lee-56b295219/">LINKEDIN</a></p></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ef05f26.js" defer></script><script src="/assets/js/2.7be8156e.js" defer></script><script src="/assets/js/42.b90bda13.js" defer></script><script src="/assets/js/37.c7880ac5.js" defer></script>
  </body>
</html>
